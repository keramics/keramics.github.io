<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Zlib compressed data - Keramics data format specifications</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Keramics data format specifications</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="zlib-compressed-data"><a class="header" href="#zlib-compressed-data">Zlib compressed data</a></h1>
<p>Zlib compression is commonly used in file formats. The zlib compressed data
format, as defined in RFC1950, allows for multiple techniques but only the
Deflate compression method, a variation of LZ77, is used.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Zlib compressed data consist of:</p>
<ul>
<li>data header</li>
<li>compressed data</li>
<li>Adler-32 checksum of the uncompressed data</li>
</ul>
<h3 id="characteristics"><a class="header" href="#characteristics">Characteristics</a></h3>
<div class="table-wrapper"><table><thead><th>Characteristics</th><th>Description</th></thead><tr><td>Byte order</td><td>big-endian</td></tr>
</table></div>
<h2 id="data-header"><a class="header" href="#data-header">Data header</a></h2>
<p>The data header is 2 or 6 bytes in size and consist of:</p>
<div class="table-wrapper"><table><thead><th>Offset</th><th>Size</th><th>Value</th><th>Description</th></thead><tr><td colspan="4"> <em>The bit values are stored a 8-bit values</em></tr>
<tr><td>0.0</td><td>4 bits</td><td></td><td><a href="#compression_method">Compression method</a></td></tr>
<tr><td>0.4</td><td>4 bits</td><td></td><td><a href="#compression_information">Compression information</a></td></tr>
<tr><td colspan="4"> <em>Flags</em></tr>
<tr><td>1.0</td><td>5 bits</td><td></td><td>Check bits</td></tr>
<tr><td>1.5</td><td>1 bit</td><td></td><td>Preset dictionary flag</td></tr>
<tr><td>1.6</td><td>2 bits</td><td></td><td><a href="#compression_level">Compression level</a>. The compression level is used mainly for re-compression</td></tr>
<tr><td colspan="4"> <em>If the dictionary identifier flag is set</em></tr>
<tr><td>2</td><td>4</td><td></td><td>Preset dictionary identifier, which contains an Adler-32 used to identifier the preset dictionary</td></tr>
<tr><td colspan="4"> <em>Common</em></tr>
<tr><td>...</td><td>...</td><td></td><td>Compressed data</td></tr>
<tr><td>...</td><td>4</td><td></td><td>Checksum, which contains an Adler-32 of the compressed data</td></tr>
</table></div>
<p>The check bits value must be such that when the first 2 bytes are represented
as a 16-bit unsigned integer in big-endian byte order the value is a multiple
of 31, such that:</p>
<pre><code>( ( first x 256 ) + second ) mod 31 = 0
</code></pre>
<h3 id="compression-method"><a class="header" href="#compression-method"><a name="compression_method"></a>Compression method</a></h3>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>8</td><td></td><td>Deflate (RFC1951), with a maximum window size of 32 KiB</td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td>15</td><td></td><td>Reserved for additional header data</td></tr>
</table></div>
<blockquote>
<p>Note that RFC1950 only defines 8 as a valid compression method.</p>
</blockquote>
<h3 id="compression-information"><a class="header" href="#compression-information"><a name="compression_information"></a>Compression information</a></h3>
<p>The value of the compression information is dependent on the compression method.</p>
<h4 id="compression-information---compression-method-8-deflate"><a class="header" href="#compression-information---compression-method-8-deflate">Compression information - compression method 8 (Deflate)</a></h4>
<p>For compression method 8 (Deflate) the compression information contains the
base-2 logarithm of the LZ77 window size minus 8.</p>
<div class="table-wrapper"><table><thead><th>Offset</th><th>Size</th><th>Value</th><th>Description</th></thead><tr><td>0.0</td><td>4 bits</td><td></td><td>Window size, which consists of a base-2 logarithm (2n), with a maximum value of 7 (32 KiB)</td></tr>
</table></div>
<p>To determine the corresponding window size:</p>
<pre><code>1 &lt;&lt; ( 7 + 8 )
</code></pre>
<p>E.g. a compression information value of 7 indicates a 32768 bytes window size.
Values larger than 7 are not allowed according to RFC1950 and thus the maximum
window size is 32768 bytes.</p>
<h3 id="compression-level"><a class="header" href="#compression-level"><a name="compression_level"></a>Compression level</a></h3>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>0</td><td></td><td>Fastest</td></tr>
<tr><td>1</td><td></td><td>Fast</td></tr>
<tr><td>2</td><td></td><td>Default</td></tr>
<tr><td>3</td><td></td><td>Slowest, maximum compression</td></tr>
</table></div>
<h2 id="compressed-data"><a class="header" href="#compressed-data">Compressed data</a></h2>
<h3 id="deflate-compressed-data"><a class="header" href="#deflate-compressed-data">Deflate compressed data</a></h3>
<p>The deflate compressed data consists of one or more deflate compressed blocks.
Each block consists of:</p>
<ul>
<li>block header</li>
<li>block data</li>
</ul>
<blockquote>
<p>Note that a block can reference uncompressed data that is stored in a previous
block.</p>
</blockquote>
<h4 id="block-header"><a class="header" href="#block-header">Block header</a></h4>
<p>The block header is 3 bits in size and consists of:</p>
<div class="table-wrapper"><table><thead><th>Offset</th><th>Size</th><th>Value</th><th>Description</th></thead><tr><td>0</td><td>1 bit</td><td></td><td>Last block (in stream) marker, where 1 represents the last block and 0 otherwise</td></tr>
<tr><td>0.1</td><td>2 bits</td><td></td><td><a href="#deflate_block_types">Block type</a></td></tr>
</table></div>
<h4 id="block-types"><a class="header" href="#block-types"><a name="deflate_block_types"></a>Block types</a></h4>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>0</td><td></td><td>Uncompressed (or stored) block</td></tr>
<tr><td>1</td><td></td><td>Fixed Huffman compressed block</td></tr>
<tr><td>2</td><td></td><td>Dynamic Huffman compressed block</td></tr>
<tr><td>3</td><td></td><td>Reserved (not used)</td></tr>
</table></div>
<h4 id="uncompressed-block-data"><a class="header" href="#uncompressed-block-data">Uncompressed block data</a></h4>
<p>The uncompressed block data is variable of size and consists of:</p>
<div class="table-wrapper"><table><thead><th>Offset</th><th>Size</th><th>Value</th><th>Description</th></thead><tr><td>0.3</td><td>5 bits</td><td></td><td>Empty values (not used)</td></tr>
<tr><td>1</td><td>2</td><td></td><td>Uncompressed data size</td></tr>
<tr><td>3</td><td>2</td><td></td><td>Copy of uncompressed data size, which contains a 1s complement of the uncompressed data size</td></tr>
<tr><td>5</td><td>...</td><td></td><td>Uncompressed data</td></tr>
</table></div>
<p>The uncompressed data size can range between 0 and 65535 bytes.</p>
<h4 id="huffman-compressed-block-data"><a class="header" href="#huffman-compressed-block-data">Huffman compressed block data</a></h4>
<p>The uncompressed block data is variable of size and consists of:</p>
<ul>
<li>Optional dynamic Huffman table</li>
<li>Encoded bit-stream</li>
<li>End-of-stream (or end-of-block or end-of-data) marker</li>
</ul>
<h5 id="dynamic-huffman-table"><a class="header" href="#dynamic-huffman-table">Dynamic Huffman table</a></h5>
<p>The dynamic Huffman table consists of:</p>
<div class="table-wrapper"><table><thead><th>Offset</th><th>Size</th><th>Value</th><th>Description</th></thead><tr><td>0.3</td><td>5 bits</td><td></td><td>Number of literal codes, which is value + 257. The number of literal codes must be smaller than 286</td></tr>
<tr><td>1.0</td><td>5 bits</td><td></td><td>Number of distance codes, which is value + 1. The number of distance codes must be smaller than 30</td></tr>
<tr><td>1.5</td><td>4 bits</td><td></td><td>The number of Huffman codes for the code sizes, which is value + 4</td></tr>
<tr><td>2.1</td><td>...</td><td></td><td>The code sizes</td></tr>
<tr><td>...</td><td>...</td><td></td><td>Huffman encoded stream of the Huffman codes for the literals</td></tr>
<tr><td>...</td><td>...</td><td></td><td>Huffman encoded stream of the Huffman codes for the distances</td></tr>
</table></div>
<p>A single code size value is 3 bits of size. A value of 0 means the code size is
not used in the Huffman encoding of the literal and distance codes.</p>
<p>The codes size values are stored in the following sequence:</p>
<pre><code>16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15
</code></pre>
<p>The first value applies to a code size of 16, the second to 17, etc. Code sizes
that are not stored default to 0.</p>
<p>The code size values are used to construct the code sizes Huffman table. This
must be a complete Huffman table which is used to decode the literal and
distance codes. The corresponding codes size Huffman encoding is defined as:</p>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>0 - 15</td><td></td><td>Represents a code size of 0 - 15</td></tr>
<tr><td>16</td><td></td><td>Copy the previous code size 3 - 6 times. The next 2 bits indicate repeat length (0 = 3, ... , 3 = 6), e.g. codes 8, 16 (+2 bits 11), 16 (+2 bits 10) will expand to 12 code lengths of 8 (1 + 6 + 5)</td></tr>
<tr><td>17</td><td></td><td>Repeat a code length of 0 for 3 - 10 times (3 bits of length)</td></tr>
<tr><td>18</td><td></td><td>Repeat a code length of 0 for 11 - 138 times (7 bits of length)</td></tr>
</table></div>
<p>Both the literal and distance Huffman codes are stored Huffman encoded using
the code sizes Huffman table. Code sizes that are not stored default to 0.
The code size for the literal code 256 (end-of-block) should be set and thus
not 0.</p>
<h5 id="encoded-bit-stream"><a class="header" href="#encoded-bit-stream">Encoded bit-stream</a></h5>
<p>The encoded bit-stream is stored in 8-bit integers, where bit values are stored
back-to-front. So that 3 least-significant bits (LSB) would represent a 3-bit
value at the start of the -stream. Note that the LSB of the 3-bit value is the
LSB of the byte value.</p>
<p>Deflate uses a Huffman tree of 288 Huffman codes (or symbols) where the values:</p>
<ul>
<li>0 - 255; represent the literal byte values: 0 - 255</li>
<li>256: represents the end of (compressed) stream (or block)</li>
<li>257 - 285 (combined with extra-bits): represent a (size, offset) tuple (or match length) of 3 - 258 bytes</li>
<li>286, 287: are not used (reserved) and their use is considered illegal although the values are still part of the tree</li>
</ul>
<p>This document refers to this Huffman tree as the literals Huffman tree.</p>
<p>The bits in the encoded bit-stream correspond to values in the literals
Huffman tree. If a symbol is found that represents a compression size and
offset tuple (or match length code) the bits following the literals symbol
contains a distance (Huffman) code. The match length coedes might require
additional (or extra) bits to store the length (or size).</p>
<p>The distances Huffman tree contains space for 32 symbols. See section
<a href="#deflate_distance_codes">Distance codes</a>. The distance code might require
additional (or extra) bits to store the distance.</p>
<h5 id="literal-codes"><a class="header" href="#literal-codes">Literal codes</a></h5>
<p>The literal codes consist of:</p>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>0x00 – 0xff</td><td></td><td>literal byte values</td></tr>
<tr><td>0x100</td><td></td><td>end-of-block marker</td></tr>
<tr><td colspan="3"> <em>0 additional bits</em></tr>
<tr><td>0x101</td><td></td><td>Size of 3</td></tr>
<tr><td>0x102</td><td></td><td>Size of 4</td></tr>
<tr><td>0x103</td><td></td><td>Size of 5</td></tr>
<tr><td>0x104</td><td></td><td>Size of 6</td></tr>
<tr><td>0x105</td><td></td><td>Size of 7</td></tr>
<tr><td>0x106</td><td></td><td>Size of 8</td></tr>
<tr><td>0x107</td><td></td><td>Size of 9</td></tr>
<tr><td>0x108</td><td></td><td>Size of 10</td></tr>
<tr><td colspan="3"> <em>1 additional bit</em></tr>
<tr><td>0x109</td><td></td><td>Size of 11 to 12</td></tr>
<tr><td>0x10a</td><td></td><td>Size of 13 to 14</td></tr>
<tr><td>0x10b</td><td></td><td>Size of 15 to 16</td></tr>
<tr><td>0x10c</td><td></td><td>Size of 17 to 18</td></tr>
<tr><td colspan="3"> <em>2 additional bits</em></tr>
<tr><td>0x10d</td><td></td><td>Size of 19 to 22</td></tr>
<tr><td>0x10e</td><td></td><td>Size of 23 to 26</td></tr>
<tr><td>0x10f</td><td></td><td>Size of 27 to 30</td></tr>
<tr><td>0x110</td><td></td><td>Size of 31 to 34</td></tr>
<tr><td colspan="3"> <em>3 additional bits</em></tr>
<tr><td>0x111</td><td></td><td>Size of 35 to 42</td></tr>
<tr><td>0x112</td><td></td><td>Size of 43 to 50</td></tr>
<tr><td>0x113</td><td></td><td>Size of 51 to 58</td></tr>
<tr><td>0x114</td><td></td><td>Size of 59 to 66</td></tr>
<tr><td colspan="3"> <em>4 additional bits</em></tr>
<tr><td>0x115</td><td></td><td>Size of 67 to 82</td></tr>
<tr><td>0x116</td><td></td><td>Size of 83 to 98</td></tr>
<tr><td>0x117</td><td></td><td>Size of 99 to 114</td></tr>
<tr><td>0x118</td><td></td><td>Size of 115 to 130</td></tr>
<tr><td colspan="3"> <em>5 additional bits</em></tr>
<tr><td>0x119</td><td></td><td>Size of 131 to 162</td></tr>
<tr><td>0x11a</td><td></td><td>Size of 163 to 194</td></tr>
<tr><td>0x11b</td><td></td><td>Size of 195 to 226</td></tr>
<tr><td>0x11c</td><td></td><td>Size of 227 to 257</td></tr>
<tr><td colspan="3"> <em>0 additional bits</em></tr>
<tr><td>0x11d</td><td></td><td>Size of 258</td></tr>
</table></div>
<h5 id="distance-codes"><a class="header" href="#distance-codes"><a name="deflate_distance_codes"></a>Distance codes</a></h5>
<p>The distance codes consist of:</p>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td>0</td><td>distance of 1</td><td></td></tr>
<tr><td>1</td><td>distance of 2</td><td></td></tr>
<tr><td>2</td><td>distance of 3</td><td></td></tr>
<tr><td>3</td><td>distance of 4</td><td></td></tr>
<tr><td colspan="3"> <em>1 additional bit</em></tr>
<tr><td>4</td><td>distance of 5 - 6</td><td></td></tr>
<tr><td>5</td><td>distance of 7 - 8</td><td></td></tr>
<tr><td colspan="3"> <em>2 additional bits</em></tr>
<tr><td>6</td><td>distance of 9 - 12</td><td></td></tr>
<tr><td>7</td><td>distance of 13 - 16</td><td></td></tr>
<tr><td colspan="3"> <em>3 additional bits</em></tr>
<tr><td>8</td><td>distance of 17 - 24</td><td></td></tr>
<tr><td>9</td><td>distance of 25 - 32</td><td></td></tr>
<tr><td colspan="3"> <em>4 additional bits</em></tr>
<tr><td>10</td><td>distance of 33 - 48</td><td></td></tr>
<tr><td>11</td><td>distance of 49 - 64</td><td></td></tr>
<tr><td colspan="3"> <em>5 additional bits</em></tr>
<tr><td>12</td><td>distance of 65 - 96</td><td></td></tr>
<tr><td>13</td><td>distance of 97 - 128</td><td></td></tr>
<tr><td colspan="3"> <em>6 additional bits</em></tr>
<tr><td>14</td><td>distance of 129 - 192</td><td></td></tr>
<tr><td>15</td><td>distance of 193 - 256</td><td></td></tr>
<tr><td colspan="3"> <em>7 additional bits</em></tr>
<tr><td>16</td><td>distance of 257 - 384</td><td></td></tr>
<tr><td>17</td><td>distance of 385 - 512</td><td></td></tr>
<tr><td colspan="3"> <em>8 additional bits</em></tr>
<tr><td>18</td><td>distance of 513 - 768</td><td></td></tr>
<tr><td>19</td><td>distance of 769 - 1024</td><td></td></tr>
<tr><td colspan="3"> <em>9 additional bits</em></tr>
<tr><td>20</td><td>distance of 1025 - 1536</td><td></td></tr>
<tr><td>21</td><td>distance of 1537 - 2048</td><td></td></tr>
<tr><td colspan="3"> <em>10 additional bits</em></tr>
<tr><td>22</td><td>distance of 2049 - 3072</td><td></td></tr>
<tr><td>23</td><td>distance of 3073 - 4096</td><td></td></tr>
<tr><td colspan="3"> <em>11 additional bits</em></tr>
<tr><td>24</td><td>distance of 4097 - 6144</td><td></td></tr>
<tr><td>25</td><td>distance of 6145 - 8192</td><td></td></tr>
<tr><td colspan="3"> <em>12 additional bits</em></tr>
<tr><td>26</td><td>distance 8193 - 12288</td><td></td></tr>
<tr><td>27</td><td>distance 12289 - 16384</td><td></td></tr>
<tr><td colspan="3"> <em>13 additional bits</em></tr>
<tr><td>28</td><td>distance 16385 - 24576</td><td></td></tr>
<tr><td>29</td><td>distance 24577 - 32768</td><td></td></tr>
<tr><td colspan="3"> <em>other</em></tr>
<tr><td>30-31</td><td>not used, reserved and illegal but still part of the tree.</td><td></td></tr>
</table></div>
<p>TODO: complete this section</p>
<h4 id="additional-bits"><a class="header" href="#additional-bits">Additional bits</a></h4>
<p>The additional bits are stored in big-endian (MSB first) and indicate the index
into the corresponding array of size values (or base size + additional size).</p>
<div class="table-wrapper"><table><thead><th>Value</th><th>Identifier</th><th>Description</th></thead><tr><td colspan="3"> <em>0 additional bits</em></tr>
<tr><td>0</td><td></td><td>Offset of 1</td></tr>
<tr><td>1</td><td></td><td>Offset of 2</td></tr>
<tr><td>2</td><td></td><td>Offset of 3</td></tr>
<tr><td>3</td><td></td><td>Offset of 4</td></tr>
<tr><td colspan="3"> <em>1 additional bit</em></tr>
<tr><td></td><td></td><td></td></tr>
</table></div>
<p>TODO: complete this section</p>
<h4 id="decompression"><a class="header" href="#decompression">Decompression</a></h4>
<p>The decompression in pseudo code:</p>
<pre><code>if( block_header.type == HUFFMANN_FIXED )
{
    initialize the fixed Huffman trees
}

do
{
    read block_header from input stream

    if( block_header.type == UNCOMPRESSED )
    {
        align with next byte
        read and check block_header.size and block_header.size_copy
        read data of block_header.size
    }
    else
    {
        if( block_header.type == HUFFMANN_DYNAMIC )
        {
            read the dynamic Huffman trees (see subsection below)
        }
        loop (until end of block code recognized)
        {
            decode literal/length value from input stream
            if( value &lt; 256 )
            {
                copy value (literal byte) to output stream
            }
            else if value = end of block (256)
            {
                 break from loop
             }
             else (value = 257..285)
             {
                 decode distance from input stream

                 move backwards distance bytes in the output
                 stream, and copy length bytes from this
                 position to the output stream.
            }
        }
    }
}
while( block_header.last_block_flag == 0 );
</code></pre>
<h3 id="adler-32-checksum"><a class="header" href="#adler-32-checksum">Adler-32 checksum</a></h3>
<p>Zlib provides a highly optimized version of the algorithm provided below.</p>
<pre><code>uint32_t adler32(
          uint8_t *buffer,
          size_t buffer_size,
          uint32_t previous_key )
{
    size_t buffer_iterator = 0;
    uint32_t lower_word    = previous_key &amp; 0xffff;
    uint32_t upper_word    = ( previous_key &gt;&gt; 16 ) &amp; 0xffff;

    for( buffer_iterator = 0;
         buffer_iterator &lt; buffer_size;
         buffer_iterator++ )
    {
        lower_word += buffer[ buffer_iterator ];
        upper_word += lower_word;

        if( ( buffer_iterator != 0 )
         &amp;&amp; ( ( buffer_iterator % 0x15b0 == 0 )
          ||  ( buffer_iterator == buffer_size - 1 ) ) )
        {
            lower_word = lower_word % 0xfff1;
            upper_word = upper_word % 0xfff1;
        }
    }
    return( ( upper_word &lt;&lt; 16 ) | lower_word );
}
</code></pre>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="http://www.ietf.org/rfc/rfc1950.txt">RFC1950 - ZLIB Compressed Data Format Specification</a></li>
<li><a href="http://www.ietf.org/rfc/rfc1951.txt">RFC1951 - DEFLATE Compressed Data Format Specification</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="plist.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="plist.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
